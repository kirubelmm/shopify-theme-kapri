<div class="{{ class }} {% if variant_image %}product__media-item--variant{% endif %}" {% if media.media_type == 'image' %}x-data="{ openZoom: false, currentMediaId: '{{ media.id }}' }"{% endif %}>
  {% case media.media_type %}
    {% when 'image' %}
      <div class="product-single__media cursor-pointer relative overflow-hidden" 
           
           @click="openZoom = true">
        <img
          class="global-media-settings global-media-settings--no-shadow w-full h-full object-cover"
          srcset="
            {%- if media.width >= 550 -%}{{ media | image_url: width: 550 }} 550w,{%- endif -%}
            {%- if media.width >= 1100 -%}{{ media | image_url: width: 1100 }} 1100w,{%- endif -%}
            {%- if media.width >= 1445 -%}{{ media | image_url: width: 1445 }} 1445w,{%- endif -%}
            {{ media | image_url }} {{ media.width }}w
          "
          sizes="(min-width: 750px) calc(100vw - 22rem), 1100px"
          src="{{ media | image_url: width: 1445 }}"
          alt="{{ media.alt | escape }}"
          width="{{ media.width }}"
          height="{{ media.height }}"
          data-media-id="{{ media.id }}"
        >
      </div>
      {% render 'zoom-overlay', media: media %}

    {% when 'model' %}
      <div class="product-media-modal__model" data-media-id="{{ media.id }}">
        <product-model class="deferred-media media media--transparent global-media-settings global-media-settings--no-shadow"
          style="padding-top: min(calc(100vh - 12rem), 100%)">
          <button id="Deferred-Poster-Modal-{{ media.id }}" class="deferred-media__poster" type="button">
            <span class="deferred-media__poster-button motion-reduce">
              {{ 'icon-3d-model' | inline_asset_content }}
            </span>
            {{ media | image_url: width: 1500 | image_tag:
              sizes: "(min-width: 1200px) calc((1200px - 10rem) / 2), (min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)",
              widths: '288, 576, 750, 1100, 1500',
              class: 'w-full'
            }}
          </button>
          <template>
            {{ media | media_tag: image_size: '2048x', toggleable: true }}
          </template>
        </product-model>
        <button
          class="button button--full-width product__xr-button"
          type="button"
          aria-label="{{ 'products.product.xr_button_label' | t }}"
          data-shopify-xr
          data-shopify-model3d-id="{{ media.id }}"
          data-shopify-title="{{ product.title | escape }}"
          data-shopify-xr-hidden
        >
          {{ 'icon-3d-model' | inline_asset_content }}
          {{ 'products.product.xr_button' | t }}
        </button>
      </div>



    {% when 'video', 'external_video' %}
      <div class="media-wrapper relative" style="padding-top: {{ 1 | divided_by: media.aspect_ratio | times: 100 }}%;">
        <div class="deferred-media absolute inset-0 w-full h-full"
             data-media-id="{{ media.id }}"
             data-media-type="{{ media.media_type }}"
             x-data="{ loaded: {% if section.settings.enable_video_autoplay %}true{% else %}false{% endif %} }"
             x-init="if (window.deferredMediaInit) { const init = window.deferredMediaInit($el); {% if section.settings.enable_video_autoplay %} $nextTick(() => init.loadMedia($el)); {% endif %} }">
          <button class="deferred-media__poster w-full h-full bg-transparent border-none p-0 cursor-pointer group"
                  @click="loaded = true; $nextTick(() => loadMedia($el.closest('.deferred-media')))"
                  {% if section.settings.enable_video_autoplay %}hidden{% endif %}>
            <span class="deferred-media__poster-button flex justify-center items-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 w-16 h-16 text-white transition-opacity group-hover:opacity-80"
                  x-show="!loaded"
                  x-cloak>
              {% render 'icon-play', class: 'w-full m-auto h-full' %}
            </span>
            {{ media.preview_image | image_url: width: 1500 | image_tag:
              sizes: "(min-width: 1200px) calc((1200px - 10rem) / 2), (min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)",
              widths: '375, 550, 750, 1100, 1500',
              class: 'w-full h-full object-cover'
            }}
          </button>
      
          <div class="deferred-media__content absolute inset-0 w-full h-full" 
               x-show="loaded" 
               x-cloak>
            {%- if media.media_type == 'video' -%}
              {{ media | media_tag: 
                image_size: '2048x',
                autoplay: true,
                loop: loop,
                controls: true,
                muted: section.settings.enable_video_autoplay,
                class: 'w-full h-full object-cover'
              }}
            {%- else -%}
              {%- liquid
                if media.host == 'youtube'
                  echo media | external_video_url: autoplay: section.settings.enable_video_autoplay | plus: 0, playsinline: 1, mute: section.settings.enable_video_autoplay | plus: 0, loop: loop | external_video_tag: class: 'w-full h-full'
                else
                  echo media | external_video_url: autoplay: section.settings.enable_video_autoplay | plus: 0, loop: loop | external_video_tag: class: 'w-full h-full'
                endif
              -%}
            {%- endif -%}
          </div>
        </div>
      </div>
      
      <script>
      // Add this to your theme's global JavaScript
      document.addEventListener('DOMContentLoaded', () => {
        window.deferredMediaInit = (element) => {
          const loadMedia = (mediaWrapper) => {
            const mediaType = mediaWrapper.dataset.mediaType;
            const content = mediaWrapper.querySelector('.deferred-media__content');
            
            if (mediaType === 'external_video') {
              const iframe = content.querySelector('iframe');
              if (iframe) iframe.src = iframe.dataset.src;
            }
          };
      
          return { loadMedia };
        };
      });
      </script>
      
      <style>
      .media-wrapper {
        width: 100%;
        overflow: hidden;
      }
      
      .deferred-media__poster {
        position: relative;
        transition: opacity 0.3s ease;
      }
      
      .deferred-media__content video,
      .deferred-media__content iframe {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      [x-cloak] {
        display: none !important;
      }
      </style>


{% else %}
      <div class="product-single__media">
        {{ media | media_tag: class: 'w-full' }}
      </div>
  {% endcase %}
</div>